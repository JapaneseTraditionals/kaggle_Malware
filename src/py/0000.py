import os
import gc
from logging import getLogger
from module.classifier_type import ClassifierType
from module.get_option import get_option
from module.output_saver import OutputSaver
from module.processor import Processor
from module.save_log import create_logger

# params
VERSION = os.path.basename(__file__)[0:4]

feature_map = {
    "Location": {
        "CountryIdentifier": {
            "simply_use": None,
            "square": None,
            "div": [
                {"attr": 4},
                {"attr": 5}
            ]
        },
        "CityIdentifier": {
            "simply_use": None,
            "exp": [
                {"attr1": 4, "attr2": 5},
                {"attr1": 10, "attr2": 14},
            ]
        },
    },
    "Others": {
        "Velocity": {
            "calc": [
                {"attr1": "Meter", "attr2": "time"}
            ]
        },
    }
    # ... many definitions
}

classifier_type = ClassifierType.LGBM

params = {
    "device": "cpu"
}


def main(args):
    # If you separate csv files, you write like belows:
    processor = Processor(args, feature_map,
                          classifier_type, params)

    validity, predict = processor.process()

    # And add validity and predict to the following list:
    validities = [validity]
    predicts = [predict]

OutputSaver.save(args, validities, predicts)


if __name__ == "__main__":
    gc.enable()
    create_logger(VERSION)
    try:
        main(get_option())
    except Exception:
        getLogger(VERSION).exception("Unexpected Exception Occurred.")
