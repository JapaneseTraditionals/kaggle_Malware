from feature_extractor import FeatureExtractor
from moco_classifier import MocoClassifier
from save_log import stop_watch


class Processor():
    """
    For processing train and test
    """
    def __init__(self, args, features,
                 clf_type, clf_params, input_path):
        """
        Parameters
        args: options from console
        features: features dictionary in json
        clf_type: classifier type in json
        clf_params: classifier parameters in json
        input_path: input csv file path in json
        """
        self.args = args
        self.feature_extractor = FeatureExtractor(features, input_path)
        self.classifier = MocoClassifier(clf_type,  clf_params)

    def process(self):
        """
        For processing train and test
        """
        validity = self.__process_train()
        predict = None
        if not self.args.dontPredict:
            predict = self.__process_test()
        return validity, predict

    @stop_watch("Processor.process_train()")
    def __process_train(self):
        """
        Processing of train
        1. Feature Extraction
        2. Fitting train data with lgbm
        ---
        Return
        validity: validation output of this process
        """
        df = self.feature_extractor.extract(is_train=True)
        self.classifier.fit(df)
        validity = 0
        return validity

    @stop_watch("Processor.process_test()")
    def __process_test(self):
        """
        Processing of test
        1. Feature Extraction
        2. Predict test data with classifier obtained from process_train()
        """
        df = self.feature_extractor.extract(is_train=False)
        submit = self.classifier.predict(df)
        return submit
