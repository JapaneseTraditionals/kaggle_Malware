from features.base_feature import BaseFeature


class Os(BaseFeature):

    def get_loadcols(self):
        cols = [
            "Platform",
            "OsVer",
            "OsBuild",
            "OsPlatformSubRelease",
            "OsBuildLab",
            "Census_OSVersion",
            "Census_OSArchitecture",
            "Census_OSBranch",
            "Census_OSBuildNumber",
            "Census_OSBuildRevision"
        ]
        return cols

    def extract(self):
        return super().extract()

    # Census_OSVersion
    def COSOsVer(self, df):
        df["Census_OSVersion"] = df["Census_OSVersion"].astype(str).apply(lambda s: float(s.split(".")[0] + "." + s.split(".")[1]))
        return df[["MachineIdentifier", "Census_OSVersion"]]

    def COSBuildNumber(self, df):
        df["Census_OSVersion"] = df["Census_OSVersion"].astype(str).apply(lambda s: int(s.split(".")[2]))
        return df[["MachineIdentifier", "Census_OSVersion"]]

    def COSBuildRevision(self, df):
        df["Census_OSVersion"] = df["Census_OSVersion"].astype(str).apply(lambda s: int(s.split(".")[3]))
        return df[["MachineIdentifier", "Census_OSVersion"]]

    # OsBuildLab
    def OSBuildNumber(self, df):
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: int(s.split(".")[0]))
        return df[["MachineIdentifier", "OsBuildLab"]]

    def OSBuildRevision(self, df):
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: int(s.split(".")[1]))
        return df[["MachineIdentifier", "OsBuildLab"]]

    def OSArchitecture(self, df):  # Category
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: s.split(".")[2])
        return df[["MachineIdentifier", "OsBuildLab"]]

    def OSBranch(self, df):  # Category
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: s.split(".")[3])
        return df[["MachineIdentifier", "OsBuildLab"]]

    def OSBuildDate(self, df):
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: s.split(".")[4])
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: int(s.split("-")[0] + s.split("-")[1]))
        return df[["MachineIdentifier", "OsBuildLab"]]

    def OSBuildDate_Year(self, df):
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: int(s.split(".")[4][:2]))
        return df[["MachineIdentifier", "OsBuildLab"]]

    def OSBuildDate_Month(self, df):
        df["OsBuildLab"] = df["OsBuildLab"].fillna("17134.1.amd64fre.rs4_release.180410-1804").str.replace(r"*", r".")
        df["OsBuildLab"] = df["OsBuildLab"].apply(lambda s: int(s.split(".")[4][2:4]))
        return df[["MachineIdentifier", "OsBuildLab"]]
