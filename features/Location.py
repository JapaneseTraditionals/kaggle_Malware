from features.base_feature import BaseFeature
from pathlib import Path
import numpy as np


class Location(BaseFeature):
    """
    https://github.com/icebee16/Malware/blob/master/notebook/eda/IE_Location_EDA.ipynb
    """

    def get_loadcols(self):
        cols = [
            "CountryIdentifier",
            "CityIdentifier",
            "GeoNameIdentifier",
            "LocaleEnglishNameIdentifier",
            "IeVerIdentifier"
        ]
        return cols

    def extract(self):
        return super().extract()

    def clfCountry(self, df):
        """
        CountryIdentifier
        """
        df["CountryIdentifier"] = df["CountryIdentifier"].fillna(df["CountryIdentifier"].mode()[0]).astype(int)
        df = df.assign(clf=0)
        df.loc[df["CountryIdentifier"] <= 5, "clf"] = 1
        df.loc[(10 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 15), "clf"] = 1
        df.loc[(20 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 25), "clf"] = 2
        df.loc[(35 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 40), "clf"] = 1
        df.loc[(45 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 55), "clf"] = 1
        df.loc[(60 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 65), "clf"] = 1
        df.loc[(70 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 80), "clf"] = 1
        df.loc[(85 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 95), "clf"] = 2
        df.loc[(115 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 125), "clf"] = 1
        df.loc[(130 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 135), "clf"] = 2
        df.loc[(160 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 170), "clf"] = 1
        df.loc[(175 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 180), "clf"] = 1
        df.loc[(185 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 195), "clf"] = 2
        df.loc[(210 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 215), "clf"] = 2
        df.loc[(215 < df["CountryIdentifier"]) & (df["CountryIdentifier"] <= 220), "clf"] = 1
        return df[["MachineIdentifier", "clf"]]

    def clfCity(self, df):
        """
        CityIdentifier
        """
        df["CityIdentifier"] = df["CityIdentifier"].fillna(df["CityIdentifier"].mode()[0]).astype(int)
        df = df.assign(clf=0)
        df.loc[(8000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 9000), "clf"] = 1
        df.loc[(10000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 11000), "clf"] = 1
        df.loc[(16000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 17000), "clf"] = 1
        df.loc[(22000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 23000), "clf"] = 1
        df.loc[(37000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 38000), "clf"] = 1
        df.loc[(52000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 53000), "clf"] = 1
        df.loc[(58000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 59000), "clf"] = 1
        df.loc[(61000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 62000), "clf"] = 1
        df.loc[(70000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 71000), "clf"] = 1
        df.loc[(76000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 77000), "clf"] = 1
        df.loc[(87000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 88000), "clf"] = 1
        df.loc[(90000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 91000), "clf"] = 1
        df.loc[(111000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 112000), "clf"] = 1
        df.loc[(129000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 130000), "clf"] = 1
        df.loc[(137000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 138000), "clf"] = 1
        df.loc[(142000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 143000), "clf"] = 1
        df.loc[(145000 < df["CityIdentifier"]) & (df["CityIdentifier"] <= 146000), "clf"] = 1
        return df[["MachineIdentifier", "clf"]]

    def clfGeoName(self, df):
        """
        GeoNameIdentifier
        """
        df["GeoNameIdentifier"] = df["GeoNameIdentifier"].fillna(df["GeoNameIdentifier"].mode()[0]).astype(int)
        df = df.assign(clf=0)
        df.loc[(10 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 20), "clf"] = 1
        df.loc[(40 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 50), "clf"] = 1
        df.loc[(50 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 60), "clf"] = 2
        df.loc[(70 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 80), "clf"] = 2
        df.loc[(80 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 100), "clf"] = 1
        df.loc[(110 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 120), "clf"] = 2
        df.loc[(180 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 190), "clf"] = 1
        df.loc[(280 < df["GeoNameIdentifier"]) & (df["GeoNameIdentifier"] <= 290), "clf"] = 2
        return df[["MachineIdentifier", "clf"]]

    def clfLocaleEnglishName(self, df):
        """
        LocaleEnglishNameIdentifier
        """
        df["LocaleEnglishNameIdentifier"] = df["LocaleEnglishNameIdentifier"].fillna(df["LocaleEnglishNameIdentifier"].mode()[0]).astype(int)
        df = df.assign(clf=0)
        df.loc[(80 < df["LocaleEnglishNameIdentifier"]) & (df["LocaleEnglishNameIdentifier"] <= 100), "clf"] = 1
        df.loc[(120 < df["LocaleEnglishNameIdentifier"]) & (df["LocaleEnglishNameIdentifier"] <= 160), "clf"] = 1
        df.loc[280 < df["LocaleEnglishNameIdentifier"], "clf"] = 1
        return df[["MachineIdentifier", "clf"]]

    def clfIeVer(self, df):
        """
        IeVerIdentifier
        """
        df["IeVerIdentifier"] = df["IeVerIdentifier"].fillna(df["IeVerIdentifier"].mode()[0]).astype(int)
        df = df.assign(clf=0)
        df.loc[(0 < df["IeVerIdentifier"]) & (df["IeVerIdentifier"] <= 20), "clf"] = 1
        df.loc[(30 < df["IeVerIdentifier"]) & (df["IeVerIdentifier"] <= 50), "clf"] = 1
        df.loc[(70 < df["IeVerIdentifier"]) & (df["IeVerIdentifier"] <= 110), "clf"] = 1
        df.loc[(120 < df["IeVerIdentifier"]) & (df["IeVerIdentifier"] <= 130), "clf"] = 1
        df.loc[(140 < df["IeVerIdentifier"]) & (df["IeVerIdentifier"] <= 230), "clf"] = 1
        df.loc[(290 < df["IeVerIdentifier"]) & (df["IeVerIdentifier"] <= 330), "clf"] = 1
        df.loc[390 < df["IeVerIdentifier"], "clf"] = 1
        return df[["MachineIdentifier", "clf"]]
